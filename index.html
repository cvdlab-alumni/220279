<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
	<meta name="description" content="Villa Valmarana Scagnolari Zen, a PLASM.js 3D rappresentation made by Francesco Furiani"/>
	<meta name="keywords" content="valmarana,scagnolari,zen,plasm,javascript,plasm.js,cvdlab,cvdlab-cg"/> 
	<meta name="author" content="Francesco Furiani"/> 
	<link rel="stylesheet" type="text/css" href="default.css" media="screen"/>
	<link rel="stylesheet" type="text/css" href="galleryLib/jquery.ad-gallery.css" media="screen"/>
	<link rel="stylesheet" href="js/source/jquery.fancybox.css?v=2.0.6" type="text/css" media="screen" />
	<title>Villa Valmarana Scagnolari Zen, a PLASM.js 3D rappresentation</title>

	<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="js/source/jquery.fancybox.pack.js?v=2.0.6"></script>
	<script type="text/javascript" src="galleryLib/jquery.ad-gallery.min.js"></script>
	<script type="text/javascript" src="js/jush-1.11.0/jush.js"></script>
	<script type="text/javascript" src="js/jush-1.11.0/jush-api.js"></script>
	<script type="text/javascript">
	$(function() {
		$(".fancybox").fancybox({
	        openSpeed  : 300,
	        closeSpeed  : 150,			
			openEffect  : 'elastic',
		    closeEffect : 'elastic',
		    titlePosition : 'inside',
        	beforeShow: function () {
	            /* Disable right click */
	            $.fancybox.wrap.bind("contextmenu", function (e) {
	                    return false;
            	});
        	}  
		});

		// Gallery
		var galleries = $('.ad-gallery').adGallery({
			loader_image: 'loader.gif',
			width: 860, 
			height: 400, 
			thumb_opacity: 0.7,
			start_at_index: 0, 
			update_window_hash: false, 
			animate_first_image: false,
			animation_speed: 400, 
			display_next_and_prev: true, 
			display_back_and_forward: false, 
			scroll_jump: 0, 
			slideshow: {
				enable: false,
				autostart: false,
				speed: 5000,
				start_label: 'Start',
				stop_label: 'Stop',
				stop_on_scroll: true
			},
			// or 'slide-vert', 'resize', 'fade', 'none' or false
			effect: 'slide-vert', 
			enable_keyboard_move: false, 
			cycle: true,
			init: function() {
			    // preloadAll uses recursion to preload each image right after one another
			    this.preloadAll();
			}
		});

		// Gallery show image
		$(document).on("click", ".ad-image", function() {
		    $.fancybox.open({
			    href : $(this).find("img").attr("src"),
			    closeBtn: true,
			    closeClick : true,
			    openSpeed  : 300,
			    closeSpeed  : 150,
				openEffect  : 'elastic',
				closeEffect : 'elastic',
				titlePosition : 'inside',
		        beforeShow: function () {
			        /* Disable right click */
			        $.fancybox.wrap.bind("contextmenu", function (e) {
			                return false;
		           	});
		        }				    
		    });
		});

		// Syntax highlight
		jush.style('js/jush-1.11.0/jush.css');
		jush.highlight_tag('code');
	});
	</script>
</head>
<body>

<div class="header">
	<h1>Villa Valmarana Scagnolari Zen</h1>
	<h3>a PLASM.js 3D representation made by Francesco Furiani</h3>
</div>

<div class="navigation">
	<a href="#Introduzione">Intro</a>
	<a href="#Architettura">Description</a>
	<a href="#Decomposition">Decomposition</a>
	<a href="#Implementation">Implementation</a>
	<a href="#Considerazioni">Conclusion</a>
	<a href="https://github.com/cvdlab-cg/220279/blob/final-project/final-project.js" target="_blank"><img src="img/icon-github.png" /> View source</a>
	<a href="./plasm.js/index.html" target="_blank"><img src="img/icon-chrome.png" /> View it</a>
	<div class="clearer"><span></span></div>
</div>

<div class="container">
	<div class="clearer"><span></span></div>
	
	<div class="content">

		<a name="Introduzione"></a>
		<h1>Introduction</h1>
		<p>Villa Valmarana (also known as Valmarana Scagnolari Zen) is a Renaissance villa in the province of Vicenza. It is one of the many villas designed by Andrea Palladio and described in his famous book collection "I Quattro Libri dell'Architettura" (The Four Books of Architecture) published in 1570.</p>
		<a href="docimg/Villa_Valmarana_Lisiera_Quattro_Libri.jpg" class="fancybox" title="Villa Valmarana original project"><img class="floatLeft resizeTinyW" src="docimg/Villa_Valmarana_Lisiera_Quattro_Libri.jpg" /></a>
		<p>The villa, as of today, is quite different from the one that Palladio designed for Gianfrancesco Valmarana, around 1563: as can be seen from the image (on the right) it shows a structure with double-storey loggias, enclosed by small towers on both fronts. The project, as intended, was never completed because the build works were interrupted in 1566 by the death of Gianfrancesco and were probably concluded by his nephew Leonardo (the heir of the family) probably using less funds. The second storey of loggias was never constructed and the middle section was terminated with some sort of attic.</p>
		<p>Unfortunately the villa was almost destroyed by bombardment during World War II and then recently reconstructed with some modifications.<a class="external" target="_blank" href="http://www.cisapalladio.org/veneto/scheda.php?sezione=4&architettura=34&lingua=e"></a></p>
		<p>The villa, after the latest reconstruction, is quite different from what Palladio had in mind: while the ground floor is mostly the same in respect of the original project, the top (and last floor) is totally different. In addition some extra structure (that is partially in ruins) has been added on the back of the villa (a wing facing north) and a wall divides the front area, with the garden, from the back one that is inaccessible to the public.</p>

		<div class="clearer"><span></span></div>
		<div class="divider"></div>

		<a name="Architettura"></a>
		<h1>General description of the project</h1>
		<a href="docimg/Alto_20m_doc.png" class="fancybox" title="Aerial photo of the villa as of today"><img class="floatRight resizeHalfW" src="docimg/Alto_20m_doc.png" /></a>
		<p>Reproducing the villa in 3D, whatever as of today or as of the original project, is quite impossible: lack of documentation makes improbable the definition of a coherent structure to implement and show. The original project, in fact, consist of only two projections (front and basement) and of the today structure there is an abundance of photo shoots of the front area of the villa (that is accessible by the public) but none of the other parts (that are inaccessible to the public).</p>
		<p>The first step was to gather all the possible documentation to make an informed decision on how to develop the whole project: after gathering a plethora of images I decided to build a <i>hybrid</i> between the original Palladio project and the villa as it is today. It was decided to proceed as follow:
		<ul>
			<li>gather the finest documentation on the front section of the villa (the south entrance in the aerial photo) and one of the two sides (the east one);</li>
			<li>use the original Palladio project to design the missing sides (using as basis the villa as of today);</li>
			<li>remove the post War World II additions (the garden wall and the partially demolished north wing).</li>
		</ul>
		Using these three guidelines I've analyzed the villa and started the hierarchical decomposition in sub-areas to proceed with the reconstruction.
		</p>

		<div class="clearer"><span></span></div>
		<div class="divider"></div>

		<a name="Decomposition"></a>
		<h1>Hierarchical decomposition</h1>
		<p>The hierarchical decomposition of the villa was done with a top-down approach.<br />
			Using the approach wrote in the <a href="#Architettura">above section</a> the villa was divided in 3 main parts:
		<ul>
			<li><a href="#Facade">Facade</a> (South side)</li>
			<li><a href="#SideWall">Side Wall</a> (East side)</li>
			<li><a href="#Roof">Roof</a></li>
		</ul>
		Each component was then decomposed in sub-objects that assembled together through translation, rotations and duplications made possible recreating the villa.<br />
		Besides the decomposition, to found a viable scale usage of aerial images was employed.
		</p>

		<a name="Facade"></a>
		<h2>Facade</h2>
		<p>
		<a class="fancybox" rel="group-Facade" href="docimg/Frontale_Liscia.jpg" title="Frontal photo of the facade"><img class="floatLeft resizeMicroW" src="docimg/Frontale_Liscia.jpg" /></a>
		<a class="fancybox" rel="group-Facade" href="docimg/Frontale_Layer.jpg" title="Frontal photo of the facade with decomposition of components (same color means same component)"><img class="floatLeft resizeMicroW" src="docimg/Frontale_Layer.jpg"/></a> 
		The facade, typical of the villas designed by Palladio, is the most complex part of the whole villa. As seen in the images on the right, the villa's facade can be decomposed into a lot of elements: some can be considered macro elements and thus composed by other elements that can be reused (completely or partially) inside other macro elements of the facade itself or of the villa.<br />
		The 3 macro elements in which the facade can be decomposed are:
		<ul>
			<li><a href="#Facade-Patio">Patio</a></li>
			<li><a href="#Facade-Pediment">Pediment</a></li>
			<li><a href="#Facade-SideWalls">Facade side walls</a></li>
		</ul>
		</p>
		<a name="Facade-Patio"></a>
		<h3>Patio</h3>
		<p>
		<a class="fancybox" rel="group-Patio" href="docimg/Patio_Detail0.jpg" title="Full image of the patio"><img class="floatLeft resizeMilliW" src="docimg/Patio_Detail0.jpg" /></a>
		<a class="fancybox" rel="group-Patio" href="docimg/Patio_Detail1.jpg" title="Deatail of the front door, windows and upper floor windows"><img class="floatLeft resizeMicroH" src="docimg/Patio_Detail1.jpg" /></a>
		<a class="fancybox" rel="group-Patio" href="docimg/Patio_Detail2.jpg" title="Detail of upper floor windows, architrave and column capital"><img class="floatLeft resizeMilliW" src="docimg/Patio_Detail2.jpg" /></a>
		<a class="fancybox" rel="group-Patio" href="docimg/Patio_Detail3.jpg" title="Detail of upper floor, architrave and column capital"><img class="floatLeft resizeMilliW" src="docimg/Patio_Detail3.jpg" /></a>	
		<div class="clearer"><span></span></div>		
		</p>
		<p>
		The patio is the entrance of the villa (in the original project it was replicated in the north side too) and it is composed by a platform on which 6 columns are placed at evenly spaced position. Inside the patio there is the main door with 2 barred windows (diagonal bars) on each side of the main door. The side walls closing the patio on the right and on the left, contains a door (like the main one but tinier).<br />
		The columns are inspired from the ionic order style without the well known 24 flutes: a stylobate separate the column from the basement then we have a base, the column itself and a capital.<br />
		Over the columns we have a typical ionic architrave that represent the separation between the ground floor and the first floor: the windows that are directly over the patio are uniquely styled with a tiny balcony made by fancy square-ish balusters.
		</p>
		<a name="Facade-Pediment"></a>
		<h3>Pediment</h3>
		<p>
		<a class="fancybox" rel="group-Tympanon" href="docimg/Tympanon_Detail0.jpg" title="Full image of the pediment"><img class="floatLeft resizeMilliW" src="docimg/Tympanon_Detail0.jpg" /></a>
		<a class="fancybox" rel="group-Tympanon" href="docimg/Tympanon_Detail1.jpg" title="Ceter detail of the tympanum and of the cornice moulding"><img class="floatLeft resizeMicroW" src="docimg/Tympanon_Detail1.jpg" /></a>
		<a class="fancybox" rel="group-Tympanon" href="docimg/Tympanon_Detail2.jpg" title="Left detail of the cornice moulding"><img class="floatLeft resizeMilliW" src="docimg/Tympanon_Detail2.jpg" /></a>
		<div class="clearer"><span></span></div>		
		</p>
		<p>
		A pediment is a classical architectural element consisting of the triangular section found above the horizontal structure (entablature), typically supported by columns. The gable end of the pediment is surrounded by the cornice moulding. The tympanum, or triangular area within the pediment, was often decorated with sculptures and reliefs demonstrating scenes of Greek and Roman mythology or allegorical figures. <a class="external" target="_blank" href="http://en.wikipedia.org/wiki/Pediment"></a><br />
		Like for the columns, a ionic style, was chosen for the pediment and although in the original project the tympanum was going to be decorated with a bas-relief in the end it was removed in the final construction.<br />
		The decomposition of this element follows strictly the classical description of it by having a cornice moulding replicated 3 times with different lenghts to form a triangle that surrounds an area called tympanum.
		</p>
		<a name="Facade-SideWalls"></a>
		<h3>Facade side walls</h3>
		<p>
		<a class="fancybox" rel="group-FacadeSideWalls" href="docimg/FacadeSide_Detail0.jpg" title="Wall to the left of the patio (corner)"><img class="floatLeft resizeMicroW" src="docimg/FacadeSide_Detail0.jpg" /></a>
		<a class="fancybox" rel="group-FacadeSideWalls" href="docimg/FacadeSide_Detail1.jpg" title="Wall to the left of the patio (frontal)"><img class="floatLeft resizeMicroW" src="docimg/FacadeSide_Detail1.jpg" /></a>
		<a class="fancybox" rel="group-FacadeSideWalls" href="docimg/FacadeSide_Detail2.jpg" title="Wall to the left of the patio (corner)"><img class="floatLeft resizeMicroW" src="docimg/FacadeSide_Detail2.jpg" /></a>
		<a class="fancybox" rel="group-FacadeSideWalls" href="docimg/FacadeSide_Detail3.jpg" title="Wall to the right of the patio (corner)"><img class="floatLeft resizeMicroW" src="docimg/FacadeSide_Detail3.jpg" /></a>
		</p>
		<div class="clearer"><span></span></div>
		<p>
		The walls on the left (and on the right) of the facade are symmetrical and their style is similar to the walls that are part of the patio: big windows with a cornice around them and vertical bars on the ground floor (like in the patio windows). <br />
		The wall just next of the patio are positioned a little behind in respect of the main line of the facade itself probably to give separation between the complex structure of the patio and the other walls (probably because of the original project that designed the right-most walls to contain arches in the ground floor). <br />
		The right-most (or left-most) part of the side walls are the beginning of an half square structure (like a turret) that ends on the side walls of the villa. <br />
		</p>

		<a name="SideWall"></a>
		<h2>Side Wall</h2>
		<p>
		<a class="fancybox" rel="group-SideWalls" href="docimg/SideWall_Detail0.jpg" title="Right side wall"><img class="floatLeft resizeMicroW" src="docimg/SideWall_Detail0.jpg" /></a>
		<a class="fancybox" rel="group-SideWalls" href="docimg/SideWall_Detail1.jpg" title="Right side wall"><img class="floatLeft resizeMicroH" src="docimg/SideWall_Detail1.jpg" /></a>
		<a class="fancybox" rel="group-SideWalls" href="docimg/SideWall_Detail2.jpg" title="Right side wall"><img class="floatLeft resizeMicroH" src="docimg/SideWall_Detail2.jpg" /></a>
		</p>
		<div class="clearer"><span></span></div>
		<p>
		There is really a lack of good photos (and generically documentation) about the side walls. They're the natural continuation of the patio left-most / right-most turrets with then a wall with 4 windows (more or less). The windows in the wall follows the style of the facade walls with possibly minor differences (but is not sure).<br />
		Since a full frontal photo without dark areas of the side wall, the original project was used as reference to complete the structure.
		</p>

		<a name="Roof"></a>
		<h2>Roof</h2>
		<p>
		<a class="fancybox" rel="group-Roof" href="docimg/Tetto_Detail0.jpg" title="Roof with statues and chimney"><img class="floatLeft resizeMicroW" src="docimg/Tetto_Detail0.jpg" /></a>
		<a class="fancybox" rel="group-Roof" href="docimg/Tetto_Detail1.jpg" title="Roof with statues and chimneys"><img class="floatLeft resizeMicroW" src="docimg/Tetto_Detail1.jpg" /></a>
		<a class="fancybox" rel="group-Roof" href="docimg/Tetto_Detail2.jpg" title="Roof with statues and chimney"><img class="floatLeft resizeMicroW" src="docimg/Tetto_Detail2.jpg" /></a>
		<a class="fancybox" rel="group-Roof" href="docimg/Tetto_Detail3.jpg" title="Aerial photo of the roof"><img class="floatLeft resizeMicroW" src="docimg/Tetto_Detail3.jpg" /></a>						
		</p>
		<div class="clearer"><span></span></div>
		<p>
		The roof is the part that is not compliant with the original Palladio's project at all: the structure, not being symmetrical at all, loses its double pediment (with the typical pediment roof), the statues are in a different position, two other chimneys (besides the original ones)were added on the left side of the villa and a skylight / side window was added at the left of the pediment roof.<br />
		Using the general idea proposed at the beginning of the document, the extra chimneys where removed along with the skylight and even the statues on the pediment roof were not included in the project.
		</p>

		<div class="clearer"><span></span></div>
		<div class="divider"></div>

		<a name="Implementation"></a>
		<h1>Implementation</h1>
		<p>
		<a class="fancybox" href="img/comic_xkcd_goto.png"><img class="floatRight resizeHalfW" src="img/comic_xkcd_goto.png" /></a>			
		Implementation of the project try to follow best practices of both Javascript and Plasm language: a functional approach where possible, reusing of components and modularized code that tries to be easily understandable. Every real world object has a counterpart in the code, this helped the re-usability and many optimizations (controlled by global switches) were implemented to permit the display of the model with different level of complexity and to help during the development phases.
		</p>
		<h2>Generic helpful objects</h2>
		<p>
		Besides representation of real objects, inside the project there are 3 "classes" containing useful functions:
		<ul>
			<li><b>PointUtils</b><br />
				containing roto-translation functions working with array of points (example below)
				<code class="jush-js">PointUtils.ruotaPunti = function(pointList, angolo, asse) {
    if (asse === 0) {
      var alfa = angolo;
      return pointList.map( function(pt) { 
		return [ pt[0], pt[1]*COS(alfa) + (-1)*pt[2]*SIN(alfa), pt[1]*SIN(alfa) + pt[2]*COS(alfa) ];
      });
    } else if (asse === 1) {
      var beta = angolo;
      return pointList.map( function(pt) { 
		return [ pt[0]*COS(beta) + pt[2]*SIN(beta), pt[1], (-1)*pt[0]*SIN(beta) + pt[2]*COS(beta) ];
      });
    } else if (asse === 2) {
      var gamma = angolo;
      return pointList.map( function(pt) { 
		return [ pt[0]*COS(gamma) + (-1)*pt[1]*SIN(gamma), pt[0]*SIN(gamma) + pt[1]*COS(gamma), pt[2] ];
      });
    }
	    
    return pointList;
};</code>
			</li>
			<li><b>CurveUtils</b><br />
				containing functions to draw all curve types (example below)
				<code class="jush-js">CurveUtils.drawCurveDebug = function(mapping, controlPoints) {
	// punti di controllo
	var listaDfacce = [];
	controlPoints.forEach( function(v,i) { listaDfacce.push([i]); } );
	DRAW( COLOR([0.1,0.6,0.2])( SIMPLICIAL_COMPLEX(controlPoints)(listaDfacce) ) );

	// curva
	var curve = MAP(mapping)(CommonDomains.DIM1_DOMAIN);
	DRAW( COLOR([0,0.5,0.5])( curve ) );
};

CurveUtils.createS0NUBS = function(degree, cPoints, debug) {
	debug = debug || false;
	var nubMap = NUBS(S0)(degree)(CurveUtils.generateS0Knots(cPoints.length, degree))(cPoints);
		
	if ( debug == true ) {
		CurveUtils.drawCurveDebug(nubMap, cPoints);
	}
		
	return nubMap;
};</code>
			</li>
			<li><b>CommonDomains</b><br />
				containing singleton domains reused in the whole project
				<code class="jush-js">if (PROJECT_HIGHRESOLUTION == false) {
	CommonDomains.DIM1_DOMAIN = INTERVALS(1)(35);
	CommonDomains.DIM2_DOMAIN = DOMAIN([[0,1],[0,1]])([35,1]);
	CommonDomains.DIM2_DOMAIN_LOWRES = DOMAIN([[0,1],[0,1]])([15,1]);
	CommonDomains.DIM2RP_DOMAIN = DOMAIN([[0,1],[0,1]])([20,15]);
	CommonDomains.DIM2R_DOMAIN = DOMAIN([[0,1],[0,2*PI]])([1,20]);
	// ...</code>
			</li>
		</p>
		<h2>Column</h2>
		<p>
			The column was implemented following the decomposition using <i class="plasm">cuboid</i> for the base, various <i class="plasm">nubs</i> curve profiles for the column and a more complex combination for the capital.
			<h3>Capital</h3>
			Although a ionic capital spiral is inspired by a nautilus shell and thus created using logarithmic equations, I decide to use the Archimedes's spiral that wield much more better looking results.
			An Archimedean spiral is defined, in polar coordinates <i class="formula">(r,&#952;)</i>, by the equation <i class="formula">r = a + b&#952;</i>, with real numbers "a" and "b": changing the parameter "a" will turn the spiral, while "b" controls the distance between successive turnings <a class="external" target="_blank" href="http://en.wikipedia.org/wiki/Archimedean_spiral"></a>. It can be easily converted in a javascript snippet to generate control points for a <i class="plasm">nubs</i> curve profile:
			<code class="jush-js">Colonna.prototype.curvaCapitello_Controls = function(raggioMax) {
	raggioMax = raggioMax || 1;
	var controlPoints = [];
	
	var i = 0;
	var angolo = PI/2;

	for (i = 0; i < 13; i++) {
		controlPoints.push( [raggioMax * ( COS(i*angolo) + i*SIN(i*angolo)  ), raggioMax * ( SIN(i*angolo) - i*COS(i*angolo)  ), 0] );
	}
	
	return controlPoints;
};</code>
			The double spiral has been created using two concentric <i class="plasm">nubs</i> and then using <i class="plasm">cylindrical_surface</i>, some <i class="plasm">simplicial_complex</i> instructions were then used to close the empty spaces left.
			<code class="jush-js">var profonditaCapitelloSolidoExt = CYLINDRICAL_SURFACE(curvaExt)([0,0,zCapitello]);
		var profonditaCapitelloSolidoInt = CYLINDRICAL_SURFACE(curvaInt)([0,0,zCapitello]);
		// Tappo a cylindrical surface
		var chiusuraSpirali = this.creaCapitello_TappoSpiraliLowRes(zCapitello, scalaSpiraleGrossa, scalaSpiralePiccola);
		// Genera il tutto
		profonditaCapitelloSolido = STRUCT([ MAP( profonditaCapitelloSolidoExt )( CommonDomains.DIM2_DOMAIN ),
											 MAP( profonditaCapitelloSolidoInt )( CommonDomains.DIM2_DOMAIN ),
											 chiusuraSpirali
										   ]);</code>
		</p>
		<h2>Patio</h2>
		<p>
			The patio was implemented by having a origin-centered <i class="plasm">struct</i> composed of 6 columns, a series of walls generated by a parametric function mainly composed of a <i class="plasm">simplex_grid</i> creating the wall itself and a call to a function that is able to generate a window or a door (an example below).
			<code class="jush-js">ModuliPareti.prototype.creaFinestraGrossa = function(frameInternoH, frameInternoV, conInferriata) {
	conInferriata = conInferriata || false;
	//
	var spessoreParete = this.spessoreParete;
	var spessoreBordo = this.spessoreBordo;
	var larghezzaParete = this.larghezzaParete;
	var altezzaParete = this.altezzaParete;
	//
	var spessBandaH = 0.3;
	var spessBandaV = spessBandaH;
	var spessVetro = spessBandaH/3;
	//
  	var sbarraVerticale = COLOR(ColoriProgetto.INFISSO_FINESTRA)(
   							SIMPLEX_GRID([[spessBandaV],[spessoreBordo],[(2/3)*frameInternoV]])
   						  );
  	var sbarraOrizzontale = COLOR(ColoriProgetto.INFISSO_FINESTRA)(
  							 SIMPLEX_GRID([[frameInternoH],[spessoreBordo],[spessBandaH]])
  							);
	var vetro = COLOR(ColoriProgetto.VETRO)(
					BOUNDARY(
   						SIMPLEX_GRID([[frameInternoH],[spessVetro],[frameInternoV]])
   					)
   				);
  	var bandeLaterali = COLOR(ColoriProgetto.INFISSO_FINESTRA)(
   					SIMPLEX_GRID([[spessBandaV],[spessBandaV],[frameInternoV]])
   				);

  	var finModel = [];
	finModel.push(T([1])([spessVetro])(vetro));
	finModel.push(bandeLaterali);
	finModel.push(T([0])([(frameInternoH-spessBandaV)])(bandeLaterali));
	finModel.push(T([0])([(frameInternoH-spessBandaV)/2])(sbarraVerticale));
	finModel.push(T([0])([spessBandaV])(sbarraOrizzontale));
	finModel.push(T([0,2])([spessBandaV,frameInternoV-spessBandaH])(sbarraOrizzontale));
	finModel.push(T([0,2])([spessBandaV,(2/3)*frameInternoV])(sbarraOrizzontale));
	if ( conInferriata == true ) {
		finModel.push(T([1])([-(spessBandaV/2)])(this.creaFinestra_InferriataDiagonale(frameInternoH, frameInternoV)));
	}	

	return STRUCT(finModel);
};</code>
			<h3>Ionic architrave</h3>
			The ionic architrave was implemented by using a first degree <i class="plasm">nubs</i> profile in combination with <i class="plasm">cylindrical_surface</i>; while the right and left angle were implemented by cloning, scaling and roto-translating the generating profile and combining two of them by using a <i class="plasm">s1 nubs</i> surface.
			<code class="jush-js">CornicionePatio.prototype.creaCornicioneAngolo = function() {
	var ctPoints = this.getControlPoints();

	// Metti punti in XZ
	ctPoints = PointUtils.ruotaPunti(ctPoints, PI/2, 0);
	var prof1 = CurveUtils.createS0NUBS(1, ctPoints);

	// Profilo ruotato
	var ctPointsRR = PointUtils.scalaPuntiAsse(this.getControlPoints(), SQRT(2), 0);
	ctPointsRR = PointUtils.ruotaPunti(ctPointsRR, PI/2, 0);
	ctPointsRR = PointUtils.ruotaPunti(ctPointsRR, PI/4, 2);
	var prof2 = CurveUtils.createS0NUBS(1, ctPointsRR);

	// Superficie
	var mapProfileCornicione = NUBS(S1)(1)([0,0,3,3])([prof1,prof2]);

	return MAP(mapProfileCornicione)(CommonDomains.DIM2_DOMAIN_LOWRES);	
};</code>
		<h3>Balcony and balusters</h3>
		The first floor right above the patio is made by six windows with an unique balcony formed by square-ish balusters: while the generation of the walls containing the windows used the same parametrized function used for the patio walls, the balusters creation and displacement required a custom function similar to the window one.
		Every single baluster is essentially a <i class="plasm">profileprod_surface</i> between two first degree <i class="plasm">nubs</i> profiles where the profiles control point can be scaled at will to generate a baluster with the right width and height.
		<code class="jush-js">ColonnaBalconcino.prototype.creaColonna = function(scaleFactorV, scaleFactorH) {
	scaleFactorV = scaleFactorV || 1;
	scaleFactorH = scaleFactorH || 1;

	// Punti controllo NUBS colonna
	var ctPoints = this.getColumnPoints();

	// Scala se necessario
	if ( scaleFactorV != 1 ) {
		ctPoints = PointUtils.scalaPunti(ctPoints, scaleFactorV);
	}

	// Metti punti in XZ
	ctPoints = PointUtils.ruotaPunti(ctPoints, PI/2, 0);
	var prof1 = CurveUtils.createS0NUBS(1, ctPoints, false);
	
	// Quadrato scala in XY
	var ctPointsQuadrato = [ [1,1,0],[1,1,0],[-1,1,0],[-1,-1,0],[1,-1,0],[1,1,0],[1,1,0] ];
	ctPointsQuadrato = PointUtils.scalaPunti(ctPointsQuadrato, this.fattoreScalaBase * scaleFactorH);
	var prof2 = NUBS(S1)(1)(CurveUtils.generateS0Knots(ctPointsQuadrato.length, 1))(ctPointsQuadrato);

	// Produttoria tra profili
	var mapProfileColonna = PROFILEPROD_SURFACE([prof1,prof2]);

	return MAP(mapProfileColonna)(CommonDomains.DIM2RP_DOMAIN);
};</code>
		</p>
		<h2>Pediment</h2>
		<p>
		The pediment creation object is a parametric one that, getting as input the lenght of each sides of the triangle and its height, is able to generate, using basic trigonometry, a full structure.<br />
		The 3 cornices surrounding the tympanum (that is a triangular <i class="plasm">simplicial_complex</i>) are generated with the same procedure employed in the architrave object: a first degree <i class="plasm">nubs</i> profile in combination with <i class="plasm">cylindrical_surface</i>; the gutta in the diagonal cornices are generated parametrically by a function (they're cubic although in the architrave of the Doric order they're cone-shaped projection used for water-repelling).<br />
		The connection between the two diagonal cornices is made using the usual cloning, scaling and roto-translation of the profiles into the creation of a <i class="plasm">nubs</i> surface.
		<code class="jush-js">TimpanoFacciata.prototype.creaCornicioneAngolato = function(lengthCorn, angoloGradi) {
	angoloGradi = angoloGradi || this.angoloDefault;
	//
	var ctPoints = this.getCPointsSotto();
	//
	var angoloRadianti = angoloGradi * PI / 180;
	var componenteY = lengthCorn*COS(angoloRadianti);
	var componenteZ = lengthCorn*SIN(angoloRadianti);

	// Metti punti in XZ
	ctPoints = PointUtils.ruotaPunti(ctPoints, PI/2, 0);
	ctPoints = PointUtils.ruotaPunti(ctPoints, angoloRadianti, 0);
	ctPoints = PointUtils.traslaPunti(ctPoints, 1, (this.hMaxPointsSotto-1.5)*SIN(angoloRadianti));
	var prof1 = CurveUtils.createS0NUBS(1, ctPoints);

	// CYLINDRICAL_SURFACE
	var mapProfileCornicione = CYLINDRICAL_SURFACE(prof1)([0,componenteY,componenteZ]);

	// Tappi laterali
	var tappiLaterali = [];
	tappiLaterali.push( this.creaTappoLaterale(ctPoints) );

	var finalModel = STRUCT([
						R([1,2])(angoloRadianti)( this.creaFregio(lengthCorn, 2, -1) ),
						STRUCT( CONS( AA(MAP)(tappiLaterali) )( CommonDomains.DIM2_DOMAIN_LOWRES ) ),
						MAP(mapProfileCornicione)(CommonDomains.DIM2_DOMAIN_LOWRES)
					]);

	return COLOR( ColoriProgetto.INTONACO_BORDI )( finalModel );
};</code>
		</p>
		<h2>Walls</h2>
		<p>
			All the walls are generated using an object that takes width as parameter and then displaced in a <i class="plasm">struct</i> that is usually symmetrical in respect of some axes so with the usage of a rotation or a scaling the rest of a bigger wall or of the villa itself is generated easily (because of its symmetrical properties in the original design) (some examples below).
			<code class="jush-js">ModuliPareti.prototype.pareteAltaFinestraGrossa = function() {
	var spessoreParete = this.spessoreParete;
	var spessoreBordo = this.spessoreBordo;
	var larghezzaParete = this.larghezzaParete;
	var altezzaParete = this.altezzaParete;
	//
	var deltaBordo = this.deltaBordo;
	//
	var frameInternoH = 5;
	var frameInternoV = 10;
	var frameEsternoH = 7 - deltaBordo;
	var frameEsternoV = 12 - deltaBordo;	
	var frameInternoHB = 6.5;
	var frameInternoVB = 13.5;
	var frameEsternoHB = 8.5 - deltaBordo;
	var frameEsternoVB = 15.5 - deltaBordo;
	var frameEsternoTV1 = 3 + deltaBordo;
	var frameEsternoTV2 = 37.5 + deltaBordo;
	//
	var bordoH = this.bordoH;
	var bordoV = this.bordoV;
	//

	var modelloParete = COLOR(ColoriProgetto.INTONACO_BASE)(
							STRUCT([ 
									// Grosso
									SIMPLEX_GRID( [[(larghezzaParete-frameInternoHB)/2,-frameInternoHB,(larghezzaParete-frameInternoHB)/2],[spessoreParete],[frameEsternoTV2]] ),
						  			SIMPLEX_GRID( [[-((larghezzaParete-frameInternoHB)/2),frameInternoHB,-((larghezzaParete-frameInternoHB)/2)],[spessoreParete],
						  			 	[frameEsternoTV1+bordoV,-frameInternoVB,frameEsternoTV2-frameEsternoTV1-frameInternoVB]] ) ,
						  			// Piccolo
						  			SIMPLEX_GRID( [[(larghezzaParete-frameInternoH)/2,-frameInternoH,(larghezzaParete-frameInternoH)/2],[spessoreParete],[-frameEsternoTV2, altezzaParete-frameEsternoTV2]] ),
						  			SIMPLEX_GRID( [[-((larghezzaParete-frameInternoH)/2),frameInternoH,-((larghezzaParete-frameInternoH)/2)],[spessoreParete],
						  			 	[-frameEsternoTV2,bordoV,-frameInternoV,altezzaParete-frameInternoV-frameEsternoTV2-bordoV]] )
							])
						);

	var bordoFinestra = COLOR(ColoriProgetto.INTONACO_BORDI)(
							STRUCT([ 	
								// Grosso
								SIMPLEX_GRID( [[-((larghezzaParete-frameInternoHB-(bordoH*2))/2),bordoH,-frameInternoHB,bordoH,-((larghezzaParete-frameInternoHB-(bordoH*2))/2)],[spessoreBordo],[-frameEsternoTV1,frameEsternoVB+bordoV]] ),
								SIMPLEX_GRID( [[-((larghezzaParete-frameInternoHB)/2),frameInternoHB,-((larghezzaParete-frameInternoHB)/2)],[spessoreBordo],[-frameEsternoTV1,bordoV,-frameInternoVB,bordoV]] ),
								// Piccolo
								SIMPLEX_GRID( [[-((larghezzaParete-frameInternoH-(bordoH*2))/2),bordoH,-frameInternoH,bordoH,-((larghezzaParete-frameInternoH-(bordoH*2))/2)],[spessoreBordo],[-frameEsternoTV2,frameEsternoV+bordoV,-(altezzaParete-frameEsternoTV2-frameEsternoV-bordoV)]] ),
								SIMPLEX_GRID( [[-((larghezzaParete-frameInternoH)/2),frameInternoH,-((larghezzaParete-frameInternoH)/2)],[spessoreBordo],[-frameEsternoTV2,bordoV,-frameInternoV,bordoV,-(altezzaParete-frameEsternoTV2-(bordoV*2)-frameInternoV)]] )
							])
						);

	var posCornicioneAlto = frameEsternoTV2 + frameEsternoV + bordoV + 3*deltaBordo - this.deltaCornicione;
	var cornicioni = this.getCornicioni(larghezzaParete, posCornicioneAlto);

	var posBordoFinestra = T([1])([-spessoreBordo])(bordoFinestra);

	var finestraVetriInf = T([0,1,2])([(larghezzaParete-frameInternoHB)/2,spessoreParete/2,frameEsternoTV1+bordoV])( this.creaFinestraGrossa(frameInternoHB, frameInternoVB, true) );
	var finestraVetriSup = T([0,1,2])([(larghezzaParete-frameInternoH)/2,spessoreParete/2,frameEsternoTV1+bordoV])( this.creaFinestraPiccola(frameInternoH, frameInternoV) );

	// finalModel
	var finalModel = [];
	finalModel.push( modelloParete );
	finalModel.push( cornicioni );
	finalModel.push( posBordoFinestra );
	finalModel.push( finestraVetriInf );
	finalModel.push( T([2])([frameEsternoTV2-frameEsternoTV1]) );
	finalModel.push( finestraVetriSup );

	return  STRUCT(finalModel);
};</code> 
			<code class="jush-js">FacciataLaterale.prototype.creaFacciataDestra = function() {
	var larghezzaPareteFrontale = CommonParetiMeasure.torretta.pareteSenzaFinestra;
	var profonditaLaterale = CommonParetiMeasure.torretta.profonditaLaterale;
	var allineamentoPatio = 1;
	//
	var pareteLateraleRModel = [];

	pareteLateraleRModel.push( this.refPareti.pareteAlta(larghezzaPareteFrontale) );
	pareteLateraleRModel.push( T([0])([larghezzaPareteFrontale]) );
	this.halfLength += larghezzaPareteFrontale;

	pareteLateraleRModel.push( this.refPareti.pareteAltaFinestraGrossa()  );
	pareteLateraleRModel.push( T([0])([this.refPareti.larghezzaParete]) );
	this.halfLength += this.refPareti.larghezzaParete;

	pareteLateraleRModel.push( this.refPareti.pareteAlta(larghezzaPareteFrontale) );
	pareteLateraleRModel.push( T([0])([larghezzaPareteFrontale]) );
	this.halfLength += larghezzaPareteFrontale;

	pareteLateraleRModel.push( R([0,1])(-PI/2)( this.refPareti.pareteAlta(profonditaLaterale) ) );
	pareteLateraleRModel.push( T([1])([-profonditaLaterale]) );
	pareteLateraleRModel.push( T([0])([-this.refPareti.spessoreBordo])( this.refPareti.getCornicioneCubico() ) );
	pareteLateraleRModel.push( this.refPareti.getCornicioni(this.refPareti.spessoreParete) );
	pareteLateraleRModel.push( T([0])([this.refPareti.spessoreParete]) );
	this.halfLength += this.refPareti.spessoreParete;

	pareteLateraleRModel.push( this.refPareti.pareteAlta(larghezzaPareteFrontale+allineamentoPatio) );	
	pareteLateraleRModel.push( T([0])([larghezzaPareteFrontale+allineamentoPatio]) );
	this.halfLength += larghezzaPareteFrontale+allineamentoPatio;

	pareteLateraleRModel.push( this.refPareti.pareteAltaFinestraPiccola()  );
	pareteLateraleRModel.push( T([0])([this.refPareti.larghezzaParete]) );
	this.halfLength += this.refPareti.larghezzaParete;

	pareteLateraleRModel.push( this.refPareti.pareteAlta(larghezzaPareteFrontale+allineamentoPatio) );
	pareteLateraleRModel.push( T([0])([larghezzaPareteFrontale+allineamentoPatio]) );
	pareteLateraleRModel.push( T([0])([ CommonParetiMeasure.spessoreBordo ]) );
	this.halfLength += larghezzaPareteFrontale+allineamentoPatio; // + CommonParetiMeasure.spessoreBordo;

	if ( PROJECT_DEBUGWALLCONNECTION == true ) {
		pareteLateraleRModel.push( COLOR(ColoriProgetto.DEBUG)( S([0])([-1])( this.refPareti.getCornicioneCubico() ) ) );
	} else {
		pareteLateraleRModel.push( S([0])([-1])( this.refPareti.getCornicioneCubico() ) );	
	}

	return STRUCT(pareteLateraleRModel);
};

FacciataLaterale.prototype.creaFacciata = function() {
	var finalModel = [];

	var pareteLateraleR = this.creaFacciataDestra();
	var pareteLateraleL = S([0])([-1])( pareteLateraleR );

	finalModel.push( pareteLateraleR );
	finalModel.push( pareteLateraleL );

	return STRUCT(finalModel);
};
</code>
		</p>
		<h2>Roof</h2>
		<p>
		Due to the symmetry, only half of the roof was designed using trigonometry and various <i class="plasm">simplical_complex</i>. The only extra object that was designed separately was the chimney that is placed into the half roof designed so it can be easily replicated.
		<code class="jush-js">Roof.prototype.creaFullTetto = function(halfX, halfY, halfPatioX, altezzaTetto, altezzaTimpano) {
	altezzaTimpano = altezzaTimpano || altezzaTetto;

	var finalModel = [];
	var halfTetto = this.creaHalfTetto(halfX, halfY, halfPatioX, altezzaTetto, altezzaTimpano);

	finalModel.push( halfTetto );
	finalModel.push( S([0])([-1])( halfTetto ) );

	if ( PROJECT_NOFUNCTIONALTRS == true ) {
		finalModel = STRUCT(finalModel).translate([1],[-halfY]);
	} else {
		finalModel = T([1])([-halfY])( STRUCT(finalModel) );
	}

	return finalModel;
};</code>
		</p>
		<h2>Final assembly</h2>
		<p>
			Since every object was designed to be hierarchically called from its "father", the final assembly is essentially calling the drawing method of the big 3 objects identified in the <a href="#Decomposition">hierarchical decomposition</a> section.
			<code class="jush-js">Progetto.prototype.disegnaModello = function() {
	var finalModel = [];

	finalModel.push( this.fullWalls() );

	if ( PROJECT_NOPLATFORM != true ) {
		finalModel.push( this.creaPiattaforme() )
	}

	if (PROJECT_NOROOF != true) {
		finalModel.push( this.fullRoof() );
	}

	return STRUCT(finalModel);
};</code>
		<h3>Centering the camera</h3>
		The project, drawn as is, is quite big, so to show it immediately after rendering a modification of the P.O.V. is needed: it can be easily done by getting the bounding box of the rendered scene and then by placing the camera using a coordinate vector using the bounding box as scale factor.<br />This procedure is called on document ready, that happens just after the final rendering.
<code class="jush-js">var centerProject = function() {
	// p is the Plasm global viewer
	var cameraControls = p.controls.controls;
	var boundingRadius = p.scene.getBoundingRadius();

	cameraControls.placeCamera(new THREE.Vector3(1.1*boundingRadius, -1.1*boundingRadius, 0.2*boundingRadius), 
								new THREE.Vector3(), new THREE.Vector3(0,0,1));
};
// Center project on document ready
$(function () {
	centerProject();
});</code>		
		</p>
		<div class="clearer"><span></span></div>
		<div class="divider"></div>

		<a name="Considerazioni"></a>
		<h1>Conclusion</h1>
		<p>
		<a class="fancybox" href="img/comic_gap_docs.jpg"><img class="floatLeft resizeMilliH" src="img/comic_gap_docs.jpg" /></a>	

		Doing the project was indeed fun and gave me the possibility to review old knowledge and learn new things about computational graphic. The usage of javascript and a web browser as development-tools made also easier working on every machine in an overall extremely stable environment. Writing documentation, as always, is a painful and very long, but at least made me review the whole project before delivery to check for mistakes.<br />
       	I would like, also, to thank the teacher and the two assistants for the help received during the development of the project, it was really helpful.<br />
       	Below there are some screenshots of the finished model and of the development phases.
		</p>

		<div class="clearer"><span></span></div>

		<h2>Project screenshots</h2>

		<h2>Author sketches and notes</h2>
		<p>Below there is a collection of hand-written notes and sketches made during the various phases of the project.</p>
		<!--Gallery sketches -->
		<div id="gallery" class="ad-gallery">
		  <div class="ad-image-wrapper">
		  </div>
		  <div class="ad-controls">
		  </div>
		  <div class="ad-nav">
			  <div class="ad-thumbs">
				  <ul class="ad-thumb-list">
				      <li>
						  <a href="docimg/notes/image01.jpg">
							  <img src="docimg/notes/thumbs/th_image01.jpg" alt="Measurements of walls" />
						  </a>
				      </li>
				      <li>
						  <a href="docimg/notes/image02.jpg">
							  <img src="docimg/notes/thumbs/th_image02.jpg" alt="Doors pattern" />
						  </a>
				      </li>
				      <li>
						  <a href="docimg/notes/image03.jpg">
							  <img src="docimg/notes/thumbs/th_image03.jpg" alt="Balcony columns" />
						  </a>
				      </li>
				      <li>
						  <a href="docimg/notes/image04.jpg">
							  <img src="docimg/notes/thumbs/th_image04.jpg" alt="Patio cornice/architrave" />
						  </a>
				      </li>
				      <li>
						  <a href="docimg/notes/image05.jpg">
							  <img src="docimg/notes/thumbs/th_image05.jpg" alt="Tympanum schematics" />
						  </a>
				      </li>
				      <li>
						  <a href="docimg/notes/image06.jpg">
							  <img src="docimg/notes/thumbs/th_image06.jpg" alt="Doors, windows, balcony" />
						  </a>
				      </li>         
				      <li>
						  <a href="docimg/notes/image07.jpg">
							  <img src="docimg/notes/thumbs/th_image07.jpg" alt="Column and capital" />
						  </a>
				      </li>
				      <li>
						  <a href="docimg/notes/image08.jpg">
							  <img src="docimg/notes/thumbs/th_image08.jpg" alt="Roof and chimney" />
						  </a>
				      </li>
				  </ul>
			  </div>
		  </div>
		</div>
		<!-- END Gallery sketches -->
	</div>

	<div class="clearer"><span></span></div>
	<div class="divider"></div>

	<div class="footer">
		&copy; 2012 by Francesco Furiani. Design by <a href="http://arcsin.se" target="_blank">Arcsin</a>.
		<br />
		<a href="https://github.com/cvdlab/plasm.js" target="_blank">plasm.js</a> &copy; 2012 Enrico Marino and Federico Spini for <a href="http://dia.uniroma3.it/~cvdlab" target="_blank">CVD Lab</a>.
		<br />
		Thanks to <a href="https://github.com/" target="_blank">GitHub</a> for the repository and webpage hosting.
		<br />
		Thanks to <a href="http://xkcd.com/" target="_blank">xkcd</a> for the comic inside this page. 
		<br />
		Thanks to <a href="http://geekandpoke.typepad.com/geekandpoke/" target="_blank">geek&amp;poke</a> for the comic inside this page. 
		<br />
		This page is powered by <a href="http://jquery.com/" target="_blank">jQuery</a>, <a href="http://coffeescripter.com/code/ad-gallery/" target="_blank">jQuery.AD-Gallery</a>, <a href="http://fancybox.net/" target="_blank">Fancybox</a> and <a href="http://jush.sourceforge.net/" target="_blank">Jush</a>.
	</div>

</div>

</body>
</html>

<!--
		<code>margin-bottom: 12px;
font: normal 1.1em "Lucida Sans Unicode",serif;
background: url(img/quote.gif) no-repeat;
padding-left: 28px;
color: #555;</code>
		<p>Eget feugiat est leo tempor quam. Ut quis neque convallis magna consequat molestie.</p>
		 <cite>Sed sodales nisl sit amet augue. Donec ultrices, augue ullamcorper posuere laoreet, turpis massa tristique justo, sed egestas metus magna sed purus.</cite> -->	